# ==================================
# CA Marketplace - Production Environment Configuration
# ==================================
# CRITICAL: This file serves as a template for production environment variables
# Configure these in GitHub Secrets, AWS Secrets Manager, or HashiCorp Vault
# NEVER EVER commit actual production credentials to version control
# ==================================

# ==================================
# Environment
# ==================================
NODE_ENV=production
PORT=5000

# ==================================
# Database Configuration
# ==================================
# Use managed database service with SSL/TLS enabled
# Connection pooling is critical for production performance
DATABASE_URL="postgresql://username:password@production-db.example.com:5432/ca_marketplace_production?sslmode=require"

# Database Pool Settings (tune based on load)
DATABASE_POOL_MIN=10
DATABASE_POOL_MAX=50
DATABASE_CONNECTION_TIMEOUT=30000
DATABASE_IDLE_TIMEOUT=10000

# ==================================
# Redis Configuration
# ==================================
# Use managed Redis service with persistence and high availability
REDIS_HOST=production-redis.example.com
REDIS_PORT=6379
REDIS_PASSWORD=production_redis_password_strong_random
REDIS_DB=0
REDIS_URL="redis://:production_redis_password_strong_random@production-redis.example.com:6379/0"
REDIS_TLS_ENABLED=true

# Redis Session Configuration
SESSION_SECRET=production-session-secret-minimum-64-characters-cryptographically-strong
SESSION_TTL=86400  # 24 hours

# ==================================
# JWT Configuration
# ==================================
# CRITICAL: Generate cryptographically strong random secrets
# Use: openssl rand -base64 64
# Rotate these secrets periodically
JWT_SECRET=production-jwt-secret-minimum-64-characters-cryptographically-strong-random
JWT_REFRESH_SECRET=production-jwt-refresh-secret-minimum-64-characters-cryptographically-strong-random
JWT_EXPIRES_IN=15m
JWT_REFRESH_EXPIRES_IN=7d

# ==================================
# CORS Configuration
# ==================================
# Only allow production domains
CORS_ORIGIN=https://camarketplace.com,https://www.camarketplace.com
CORS_CREDENTIALS=true

# ==================================
# Payment Gateway (Razorpay)
# ==================================
# CRITICAL: Use LIVE mode credentials
# Store webhook secret securely
RAZORPAY_KEY_ID=rzp_live_production_key_id
RAZORPAY_KEY_SECRET=production_razorpay_secret_key_live
RAZORPAY_WEBHOOK_SECRET=production_webhook_secret_strong_random

# Platform Fee Configuration (in percentage)
PLATFORM_FEE_PERCENTAGE=10

# ==================================
# Email/SMTP Configuration
# ==================================
# Use reliable transactional email service with high deliverability
SMTP_HOST=smtp.sendgrid.net
SMTP_PORT=587
SMTP_SECURE=true
SMTP_USER=apikey
SMTP_PASSWORD=production_sendgrid_api_key
SMTP_FROM_EMAIL=noreply@camarketplace.com
SMTP_FROM_NAME=CA Marketplace

# Email Rate Limiting
EMAIL_RATE_LIMIT=100  # per hour
EMAIL_QUEUE_ENABLED=true

# ==================================
# AWS / S3 Configuration
# ==================================
# Use IAM roles when possible, fallback to access keys
AWS_ACCESS_KEY_ID=production_aws_access_key
AWS_SECRET_ACCESS_KEY=production_aws_secret_key
AWS_REGION=ap-south-1
AWS_S3_BUCKET=ca-marketplace-production
AWS_S3_ENDPOINT=  # Leave empty for AWS S3

# S3 Encryption
S3_SERVER_SIDE_ENCRYPTION=AES256
S3_ACL=private

# Backup S3 Configuration
BACKUP_BUCKET=ca-marketplace-production-backups
BACKUP_ENCRYPTION_KEY=kms:alias/ca-marketplace-backup

# ==================================
# File Upload Configuration
# ==================================
MAX_FILE_SIZE=10485760  # 10MB in bytes
ALLOWED_FILE_TYPES=pdf,doc,docx,xls,xlsx,jpg,jpeg,png
FILE_SCAN_ENABLED=true  # Virus scanning

# ==================================
# Monitoring & Logging
# ==================================
# CRITICAL: Enable comprehensive monitoring
SENTRY_DSN=https://production_key@o123456.ingest.sentry.io/123456
SENTRY_ENVIRONMENT=production
SENTRY_TRACES_SAMPLE_RATE=0.1
SENTRY_PROFILES_SAMPLE_RATE=0.1
LOG_LEVEL=warn
LOG_FORMAT=json

# DataDog / New Relic Configuration (if used)
DATADOG_API_KEY=production_datadog_api_key
DATADOG_APP_KEY=production_datadog_app_key
APM_ENABLED=true

# ==================================
# Rate Limiting
# ==================================
# Strict rate limiting for production
RATE_LIMIT_WINDOW_MS=900000  # 15 minutes
RATE_LIMIT_MAX_REQUESTS=60
RATE_LIMIT_REDIS_ENABLED=true

# DDoS Protection
DDOS_PROTECTION_ENABLED=true
MAX_REQUESTS_PER_SECOND=10

# ==================================
# Feature Flags
# ==================================
# Production feature flags
FEATURE_PAYMENTS_ENABLED=true
FEATURE_EMAIL_NOTIFICATIONS=true
FEATURE_SMS_NOTIFICATIONS=true
FEATURE_REVIEW_SYSTEM=true
FEATURE_CHAT_SYSTEM=true

# ==================================
# Security
# ==================================
# Maximum security settings
BCRYPT_ROUNDS=12
PASSWORD_MIN_LENGTH=12
PASSWORD_REQUIRE_UPPERCASE=true
PASSWORD_REQUIRE_LOWERCASE=true
PASSWORD_REQUIRE_NUMBER=true
PASSWORD_REQUIRE_SPECIAL=true
MAX_LOGIN_ATTEMPTS=3
LOCKOUT_DURATION=1800000  # 30 minutes

# Security Headers
HELMET_ENABLED=true
HSTS_ENABLED=true
HSTS_MAX_AGE=31536000
CSP_ENABLED=true

# ==================================
# API Configuration
# ==================================
API_VERSION=v1
API_BASE_PATH=/api
API_RATE_LIMIT=60
API_TIMEOUT=30000

# ==================================
# Frontend URLs
# ==================================
FRONTEND_URL=https://camarketplace.com
BACKEND_URL=https://api.camarketplace.com

# ==================================
# SSL/TLS Configuration
# ==================================
SSL_ENABLED=true
FORCE_HTTPS=true
TRUST_PROXY=true

# ==================================
# Session Configuration
# ==================================
SESSION_DOMAIN=.camarketplace.com
SESSION_SECURE=true
SESSION_HTTP_ONLY=true
SESSION_SAME_SITE=strict

# ==================================
# Deployment Configuration
# ==================================
DEPLOYMENT_ENVIRONMENT=production
HEALTH_CHECK_PATH=/monitoring/health
METRICS_ENABLED=true
GRACEFUL_SHUTDOWN_TIMEOUT=30000

# ==================================
# Database Backup Configuration
# ==================================
# CRITICAL: Regular automated backups
BACKUP_RETENTION_DAYS=90
AUTO_BACKUP_ENABLED=true
BACKUP_SCHEDULE="0 2 * * *"  # Daily at 2 AM
BACKUP_VERIFICATION_ENABLED=true

# Point-in-time recovery
PITR_ENABLED=true
TRANSACTION_LOG_RETENTION_DAYS=7

# ==================================
# Cache Configuration
# ==================================
# Aggressive caching for performance
CACHE_TTL_DEFAULT=3600  # 1 hour
CACHE_TTL_SHORT=300     # 5 minutes
CACHE_TTL_LONG=86400    # 24 hours
CACHE_REDIS_CLUSTER_ENABLED=true

# ==================================
# External Services
# ==================================
# ICAI API for CA verification
ICAI_API_URL=https://api.icai.org
ICAI_API_KEY=production_icai_api_key
ICAI_API_TIMEOUT=10000

# GST API for business verification
GST_API_URL=https://api.gst.gov.in
GST_API_KEY=production_gst_api_key
GST_API_TIMEOUT=10000

# ==================================
# Compliance & Audit
# ==================================
# GDPR Compliance
GDPR_DATA_RETENTION_DAYS=2555  # 7 years
GDPR_AUDIT_LOG_ENABLED=true
GDPR_ANONYMIZATION_ENABLED=true

# Financial Compliance
FINANCIAL_AUDIT_LOG_ENABLED=true
TAX_CALCULATION_ENABLED=true
INVOICE_GENERATION_ENABLED=true

# ==================================
# Prisma Configuration
# ==================================
PRISMA_LOG_LEVEL=warn
PRISMA_QUERY_LOG=false
PRISMA_CONNECTION_LIMIT=50

# ==================================
# Performance Optimization
# ==================================
# Connection pooling and optimization
CONNECTION_POOL_ENABLED=true
QUERY_CACHING_ENABLED=true
RESPONSE_COMPRESSION=true

# CDN Configuration
CDN_ENABLED=true
CDN_URL=https://cdn.camarketplace.com
STATIC_ASSETS_CDN=true

# ==================================
# Disaster Recovery
# ==================================
# Multi-region failover
DR_ENABLED=true
DR_REGION=ap-southeast-1
FAILOVER_AUTOMATIC=false

# ==================================
# Alerting Configuration
# ==================================
# Critical alerts
ALERT_EMAIL=alerts@camarketplace.com
ALERT_SLACK_WEBHOOK=https://hooks.slack.com/services/xxx/yyy/zzz
ALERT_PAGERDUTY_KEY=production_pagerduty_integration_key

# Alert Thresholds
ALERT_ERROR_RATE_THRESHOLD=1  # 1% error rate
ALERT_RESPONSE_TIME_THRESHOLD=1000  # 1 second
ALERT_CPU_THRESHOLD=80  # 80% CPU usage
ALERT_MEMORY_THRESHOLD=80  # 80% memory usage

# ==================================
# Production Security (NEVER ENABLE IN PROD)
# ==================================
SHOW_STACK_TRACES=false
ENABLE_PLAYGROUND=false
ENABLE_INTROSPECTION=false
DEBUG_MODE=false

# ==================================
# Secrets Management
# ==================================
# If using AWS Secrets Manager or HashiCorp Vault
SECRETS_MANAGER_ENABLED=false
SECRETS_MANAGER_REGION=ap-south-1
VAULT_ADDR=https://vault.example.com
VAULT_TOKEN=  # Use IAM role instead

# ==================================
# Container/K8s Configuration
# ==================================
POD_NAME=${HOSTNAME}
POD_NAMESPACE=production
CLUSTER_NAME=ca-marketplace-prod

# ==================================
# Notes
# ==================================
# 1. Use AWS Secrets Manager or HashiCorp Vault for secret management
# 2. Rotate all secrets quarterly
# 3. Enable MFA for all production access
# 4. Review and update security settings regularly
# 5. Monitor all environment variables for exposure
# 6. Use IAM roles instead of access keys when possible
# 7. Enable audit logging for all configuration changes
# 8. Test disaster recovery procedures quarterly
